<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr">
<head>
<title>Performance - Coppermine Photo Gallery - Documentation &amp; Manual</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="language" content="en" />
<meta name="copyright" content="Coppermine dev team" />
<meta name="description" content="Coppermine Photo Gallery project - Coppermine is an easily set-up, fast, feature-rich photo gallery script with mySQL database, user management, private galleries, automatic thumbnail creation, ecard feature and a template system for easy customization to match the rest of a site." />
<meta http-equiv="Content-Style-Type" content="text/css" />
<meta name="MSSmartTagsPreventParsing" content="true" />
<meta http-equiv="imagetoolbar" content="no" />
<!--
  SVN version info:

  Coppermine version: 1.5.1
  $Revision$
  $LastChangedBy$
  $Date$
-->
<link rel="stylesheet" type="text/css" href="../style/style.css" media="all" />
<link rel="stylesheet" type="text/css" href="../style/screen.css" media="screen" />
<link rel="stylesheet" type="text/css" href="../style/print.css" media="print" />
<link rel="shortcut icon" href="../favicon.ico" />
<script src="../js/jquery.js" type="text/javascript"></script>
<script src="../js/jquery.treeview.js" type="text/javascript"></script>
<script src="script.js" type="text/javascript"></script>
</head>
<body>
<script type="text/javascript">
  cpgDocHeader();
</script>
<div id="toc">
<script type="text/javascript">
  cpgDocToc();
</script>
<noscript>
<a href="toc.htm">Table of Contents</a>
</noscript>
</div>

<a name="perf_tips"></a><h1>Performance tips<a href="#perf_tips" title="Link to this section"><img src="images/anchor.gif" width="15" height="9" border="0" alt="" /></a></h1>
<p>Here are some tips to get the best performance from your Coppermine gallery. It covers changes you can make to both Coppermine's configuration and your server configuration (if you have access to that of course).</p>

<a name="perf_config"></a><h2>Configuration settings<a href="#perf_config" title="Link to this section"><img src="images/anchor.gif" width="15" height="9" border="0" alt="" /></a></h2>
<p>Many of the configuration options have performance implications. Some features can cause load issues when used on large galleries or galleries that are structured in an unusual way.
The general advice is to disable any feature you don't actually make use of and to keep any numeric options sane.</p>
<br />

<a name="perf_config_general"></a><h3>General<a href="#perf_config_general" title="Link to this section"><img src="images/anchor.gif" width="15" height="9" border="0" alt="" /></a></h3>
<p>Things that increase server load generally</p>
<br />
<ul>
    <li><strong>Number of &lt;something&gt;</strong> - Keep the number of anything set to reasonable values, the defaults are usually fine for most galleries.</li>
    <li><strong><a href="configuration.htm#admin_general_enable-plugins">Enable plugins</a></strong> - If you don't use <a href="plugins.htm#plugin">plugins</a>, you can disable the plugin system entirely. Don't add all known plugins to your gallery - just add those that you need.  You can disable individual plugins on the plugin manager page to troubleshoot speed and server load issues.  A disabled plugin doesn't do anything except be listed on the plugin manager page.</li>
    <li><strong>Non-English language</strong> - Displaying your gallery in a <a href="languages.htm">language</a> other than English (US) carries a small performance penalty.</li>
    <li><strong><a href="configuration.htm#admin_album_list_content">The content of the main page</a></strong> - Keep this setting simple so your index page loads quickly.  Avoid using the <em>random</em> block on very large galleries.  The "lastalb" (last-updated albums) block can be slow on very large galleries, particularly if you have the album thumbnail set to "random" or "last uploaded" for most albums.</li>
    <li><strong><a href="configuration.htm#admin_album_linked_files_start">Show number of linked files</a></strong> - This requires an additional database query per album displayed on the index page - disable if not needed.</li>
    <li><strong><a href="configuration.htm#admin_allow_user_album_keyword">Allow users to assign album keywords</a></strong> - The <em>linked files</em> feature is not suitable for very large galleries.</li>
    <li><strong><a href="configuration.htm#admin_thumbnail_display_comments">Display number of comments below the thumbnail</a></strong> - This requires an additional database query per file displayed in an album view - disable if not needed.</li>
    <li><strong><a href="configuration.htm#admin_thumbnail_default_sortorder">Default sort order for files</a></strong> - Avoid sorting by filename or title; sorting by date or position is faster.</li>
    <li><strong><a href="configuration.htm#admin_image_comment_filmstrip_toggle">Show film strip</a></strong> - The filmstrip requires an additional database query to display - disable if not needed.</li>
    <li><strong><a href="configuration.htm#admin_picture_thumb_advanced_private_toggle">Albums can be private</a></strong> - Disabling this allows privacy/visibility checks to be skipped, helping performance.</li>
    <li><strong><a href="configuration.htm#admin_user_purge_expired_bans">Automatically purge expired bans</a></strong> - Enabling this keeps the bans table smaller and so faster.</li>
    <li><strong><a href="configuration.htm#admin_logging_display_stats_on_index">Display statistics on index page</a></strong> - Disabling this will avoid the expensive stats queries on the index page.</li>
    <li><strong><a href="configuration.htm#admin_logging_votedetails">Keep detailed vote statistics</a></strong> - Disabling this will help keep the database small.</li>
    <li><strong><a href="configuration.htm#admin_logging_hitdetails">Keep detailed hit statistics</a></strong> - Disabling this will help keep the database small.</li>
    <li><strong><a href="configuration.htm#admin_count_file_hits">Count file views</a> / <a href="configuration.htm#admin_count_album_hits">Count album views</a></strong> - Disabling these will mean fewer writes to the pictures/albums table which helps the MySQL query cache be more efficient.</li>
    <li><strong><a href="configuration.htm#debug_mode">Enable debug mode</a></strong> - Debug more itself will increase load times as a result of the additional information it displays. Unless you are actually debugging your gallery keep this disabled.</li>
    <li><strong><a href="configuration.htm#admin_general_coppermine_news">Display news from coppermine-gallery.net</a></strong> - This causes a small delay while the news is fetched. Only applies for the admin, so your site's visitors won't notice a difference.</li>
    <li><strong><a href="albums.htm#album_prop">Album Properties</a>: Album Thumbnail</strong> - Choosing "Last Uploaded" or "Random" for an album thumbnail adds extra queries for each such album shown on a page.  Choose a specific image to avoid these queries.</li>
</ul>

<a name="perf_config_spikes"></a><h3>Spiking<a href="#perf_config_spikes" title="Link to this section"><img src="images/anchor.gif" width="15" height="9" border="0" alt="" /></a></h3>
<p>Things that can cause load spikes on specific pages. If you are on a shared server you should avoid creating load spikes.</p>
<br />

<ul>
    <li><strong>Allow ZIP-download of favorites</strong> - Creating zip files on the server is resource intensive.</li>
    <li><strong>Enable clickable keywords in search</strong> - Loading the list of clickable keywords can take some time if you have a lot of them.</li>
    <li><strong>Process concurrency for batch-add interface</strong> - Keep this small; a value of 1 is best to keep load down when batch adding.</li>
    <li><strong>Display preview thumbnails on batch-add interface</strong> - Building the preview thumbs can be resource intensive.</li>
    <li><strong>Comments per page</strong> - If you have a lot of comments make sure this is set to something reasonable. Having 1000 comments displayed on one page will cause it to load slowly.</li>
    <li><strong>Method for resizing images</strong> - If you use GD you may hit PHP resource limits. If you use ImageMagick you can evade some resource restrictions since it runs outside PHP.</li>
    <li><strong>Read EXIF data in JPEG files</strong> - If this is enabled the image will take longer to load the first time it is accessed as the EXIF data is read.</li>
    <li><strong>Watermarking</strong> - Watermarking your images on the server will use more resources. Watermark before uploading if possible.</li>
    <li><strong>SMTP</strong> - Offloading your email sending to another server or provider may help. Effectiveness of this depends on how many email related features you use.</li>
</ul>

<a name="perf_php"></a><h2>PHP settings<a href="#perf_php" title="Link to this section"><img src="images/anchor.gif" width="15" height="9" border="0" alt="" /></a></h2>
<p>If you have control over your server you can improve Coppermine's performance by adjusting your PHP configuration.</p>
<br />

<ul>
    <li><strong>Use the latest version</strong> - Use the latest stable version for best performance - PHP 5.2 is much faster than previous versions.</li>
    <li><strong>Use a PHP accelerator</strong> - These can cut page load times by 40% or so. Note: Coppermine won't use any data caching ability but will benefit from bytecode caching. See list at <a href="http://en.wikipedia.org/wiki/PHP_accelerator" rel="external" class="external">Wikipedia</a>.</li>
</ul>

<a name="perf_mysql"></a><h2>MySQL settings<a href="#perf_mysql" title="Link to this section"><img src="images/anchor.gif" width="15" height="9" border="0" alt="" /></a></h2>
<p>If you have control over your server you can improve Coppermine's performance by adjusting your MySQL configuration.</p>
<br />

<ul>
    <li><strong>Use the latest version</strong> - Use the latest stable version for best performance.</li>
    <li><strong>Enable the query cache</strong> - This helps both reduce server load and page load time.</li>
    <li><strong>Tune the configuration</strong> - Use a tool like <a href="http://wiki.mysqltuner.com/MySQLTuner" rel="external">MySQLTuner</a> or <a href="http://www.day32.com/MySQL/" rel="external">tuning-primer.sh</a> to tweak MySQL for your usage patterns.</li>
    <li><strong>OPTIMIZE your database tables</strong> - Running an OPTIMIZE on your database tables using phpMyAdmin can help improve performance, especially after major updates to your gallery's content.</li>
</ul>

<a name="perf_yslow"></a><h2>YSlow<a href="#perf_yslow" title="Link to this section"><img src="images/anchor.gif" width="15" height="9" border="0" alt="" /></a></h2>
<p>YSlow analyzes web pages and tells you why they're slow based on the <a href="http://developer.yahoo.com/performance/index.html#rules" rel="external" class="external">rules for high performance web sites</a>. YSlow is a <a href="https://addons.mozilla.org/en-US/firefox/addon/5369" rel="external" class="external">Firefox add-on</a> integrated with the popular <a href="http://www.getfirebug.com/" rel="external" class="external">Firebug</a> web development tool.</p>
<p>By adding an <i>.htaccess</i> file containing the following code into your Coppermine gallery directory you can apply some of these suggestions. If you do not use Apache as your webserver you will need to find the corresponding configuration settings for your webserver of choice. If your site no longer works after making these changes you can simply rename or delete the <i>.htaccess</i> file.</p>
<br />

<ul>
    <li>
        <strong>3. Add an Expires header</strong>
        <pre class="code">
        
&lt;IfModule mod_expires.c&gt;
    ExpiresActive on
    ExpiresDefault &quot;access plus 2 weeks&quot;
    ExpiresByType text/html &quot;access plus 1 seconds&quot;
&lt;/IfModule&gt;</pre>
    </li>
    <li>
        <strong>4. Gzip components</strong>
        <pre class="code">
        
&lt;IfModule mod_deflate.c&gt;
	AddOutputFilterByType DEFLATE application/x-javascript text/css text/html
&lt;/IfModule&gt;</pre>
    </li>    
    <li>
        <strong>13. Configure ETags</strong>
        <pre class="code">
        
FileETag none</pre>
    </li>      
 </ul>


<script type="text/javascript">
  cpgDocFooter();
  dateRevision(' $LastChangedDate$ ', ' $Revision$ ');
</script>

</body>
</html>
