<!doctype html public "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>Upgrading - Coppermine Photo Gallery - Documentation &amp; Manual</title>
<meta http-equiv="content-type" content="text/html; charset=iso-8859-1">
<meta name="language"    content="en">
<meta name="copyright"   content="Coppermine dev team">
<meta name="description" content="Steps needed to perform when upgrading Coppermine">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta name="MSSmartTagsPreventParsing" content="true">
<meta http-equiv="imagetoolbar" content="no">
<!--
  SVN version info:

  Coppermine version: 1.5.0
  $Revision$
  $LastChangedBy$
  $Date$
-->
<link rel="stylesheet" type="text/css" href="style.css" media="all" />
<link rel="stylesheet" type="text/css" href="screen.css" media="screen" />
<link rel="stylesheet" type="text/css" href="print.css" media="print" />
<link rel="shortcut icon" href="favicon.ico" />
<script src="script.js" type="text/javascript"></script>
</head>
<body>
<script type="text/javascript">
  cpgDocHeader();
</script>
<div id="toc">
<script type="text/javascript">
  cpgDocToc();
</script>
<noscript>
<a href="toc.htm">Table of Contents</a>
</noscript>
</div>

<a name="upgrade"></a><h1>Upgrading<a href="#upgrade" title="Link to this section"><img src="pics/anchor.gif" width="15" height="9" border="0" alt="" /></a></h1>
<p>Please note: as there have been changes both in the coppermine files and the database from previous versions to cpg1.5.x, users of older versions than cpg1.5.0 will have to apply all steps mentioned above: both the files have to be replaced and the update.php script has to be run once.</p>

<a name="upgrade_any"></a><h2>Steps needed to perform when upgrading Coppermine (from any version)<a href="#upgrade_any" title="Link to this section"><img src="pics/anchor.gif" width="15" height="9" border="0" alt="" /></a></h2>
<ul>
    <li>Download the most recent stable version existing in the download section of the <a href="http://coppermine-gallery.net/">official Coppermine homepage</a><br />
    <span class="small">(Don't assume that you have the most recent version, especially if you have installed Coppermine using a control panel app provided by your webhost. The coppermine dev team doesn't recommend using such <a href="auto-installers.htm#auto-installers">auto-installers</a> - please download the original from <i>our</i> site)</span></li>
    <li>Make a backup (dump) of your database<br />
    <span class="small">(Recommended tools for creating a database dump are <a href="http://mysqldumper.de/en/" rel="external" class="external">mySqlDumper</a> or <a href="http://phpmyadmin.net/" rel="external" class="external">phpMyAdmin</a>)</span></li>
    <li>Backup your include/config.inc.php file, your anycontent.php file and your &quot;albums&quot; directoy as a safety precaution if anything should go wrong.<br />
    <span class="small">(Usually, you just download your entire coppermine folder to your local hard drive using your FTP app)</span></li>
    <li>Unpack the coppermine package you downloaded into a temporary folder on your local hard drive (preserving the folder structure within the package)</li>
    <li><strong>Except for the &quot;albums&quot; directory</strong>, upload all of the new files and directories making sure not to overwrite your anycontent.php file or the albums directory.</li>
    <li>Run the file &quot;update.php&quot; in the coppermine directory once in your browser (e.g. http://yourdomain.tld/your_coppermine_folder/update.php). This will update your coppermine install by making all necessary changes in the database.</li>
    <li>If you have made a custom theme, apply the changes that were introduced in the themes structure to your custom-made theme - refer to the <a href="theme_upgrade_13x-14x.htm">theme-upgrade guide</a>.</li>
    <li>If your webserver is running in safe_mode and you have enabled "SILLY_SAFE_MODE" in include/config.inc.php, you will have to go to coppermine's config after performing above mentioned steps and enable "<a href="configuration.htm#admin_picture_thumb_advanced_silly_safe_mode_start">silly safe mode</a>" there, as the setting in include/config.inc.php is no longer being taken into account in cpg1.5.x. The silly_safe_mode setting has been made into a <a href="configuration.htm#admin_picture_thumb_advanced_silly_safe_mode_start">config setting</a> instead.</li>
</ul>



<a name="upgrade_particular"></a><h2>Additional actions for updating from particular versions<a href="#upgrade_particular" title="Link to this section"><img src="pics/anchor.gif" width="15" height="9" border="0" alt="" /></a></h2>
<p>Depending on the version you're updating from, there are additional actions you need to perform:</p>


<a name="upgrade_10"></a><h3>Upgrading from version cpg1.0 or cpg1.1<a href="#upgrade_10" title="Link to this section"><img src="pics/anchor.gif" width="15" height="9" border="0" alt="" /></a></h3>

<p>Support for a direct upgrade from cpg1.0 or cpg1.1 has been dropped - if you still have such an ancient version running, you will have to upgrade in a two-step-process (from your version to cpg1.4.x and then on to cpg1.5.x)</p>


<a name="upgrade_12"></a><h3>Upgrading from cpg1.2.x or cpg1.3.x to version cpg1.5.x<a href="#upgrade_12" title="Link to this section"><img src="pics/anchor.gif" width="15" height="9" border="0" alt="" /></a></h3>
<ul>
  <li>Delete all leftover, outdated language files in the lang folder that are named XXX-utf-8.php</li>
  <li>If you have not already done so, create a folder called &quot;edit&quot; within your &quot;albums&quot; directory - this folder will be used by coppermine as a temporary folder, do not ftp-upload files there. Make sure the new &quot;edit&quot;-folder is CHMODed the same way your albums-directory is (755 or 777, depending on your server's config)</li>
  <li>If you have made a custom theme, apply the changes that were introduced in the themes structure to your custom-made theme - refer to the <a href="theme_upgrade_13x-14x.htm">theme-upgrade guide</a>.</li>
  <li>You can not use language files from older versions of Coppermine as primary language (the language the admin will use) - make sure you only have the language files that come with this package inside of your lang folder (delete or rename all files from older versions within the lang folder).<br />
        If you need to use a language that hasn't been translated for cpg1.5.x, you can try using the language file from cpg1.3.x or better, however there are certain caveats:
      <ul>
        <li>You need to enable the <a href="configuration.htm#admin_language_fallback">language fallback</a> option in coppermine's config page if you want to use a language file from cpg1.3.x with cpg1.4.x</li>
        <li>cpg1.5.x-phrases that don't exist in your old language file will go untranslated or show in english</li>
        <li>Coppermine can't be administered using an old language file - the admin needs to use a "true" cpg1.5.x language file</li>
        <li>You're free to try using old language files, however when running into issues or error messages, switch to US-English and see if the issue goes away then. Using outdated language files goes unsupported</li>
      </ul>
  </li>
  <li>The bridging method has changed from cpg1.3.x to cpg1.4.x. When upgrading, your bridged coppermine install will be unbridged - you will have to re-apply the bridging using the <a href="bridging.htm">bridge-manager</a> (using your standalone admin account you initially used to set up coppermine). You will not lose anything though, don't worry.</li>
</ul>



<a name="upgrade_14"></a><h3>Upgrading from cpg1.4.x to version cpg1.5.x<a href="#upgrade_14" title="Link to this section"><img src="pics/anchor.gif" width="15" height="9" border="0" alt="" /></a></h3>
<p>tbc</p>



<a name="versioncheck"></a><h2>The version check tool<a href="#versioncheck" title="Link to this section"><img src="pics/anchor.gif" width="15" height="9" border="0" alt="" /></a></h2>
<p>Since the release of cpg1.3.2 Coppermine comes with an additional version checking tool to help you resolve issues with upgrades and updates easily. Except for specific files of coppermine that will only work for the version that it had been originally designed for, the versioncheck tool can be used with all versions starting from cpg1.2.1. To launch the versioncheck, simply add <tt>versioncheck.php</tt> to your browser's address bar after being logged into coppermine as admin (example: <tt>http://yourdomain.tld/your_coppermine_folder/versioncheck.php</tt>).  With version 1.5.x, you can run the versioncheck utility from the <a href="admin_menu.htm#admin_menu">Admin menu</a>.</p>


<a name="versioncheck_description_start"></a><h3>What it does<a href="#versioncheck_description_start" title="Link to this section"><img src="pics/anchor.gif" width="15" height="9" border="0" alt="" /></a></h3>
<p>The script &quot;versioncheck&quot; is meant for two purposes:</p>
<ul>
	<li>If you have upgraded from a previous version, you should perform versioncheck to see if your upgrade worked as expected</li>
	<li>Use versioncheck to make sure that your coppermine version is up-to-date</li>
</ul>
<p>This script goes through the files on your webserver and tries to determine if the local file versions on your webserver are the identical to the ones at the repository of http://coppermine-gallery.net. Files that do not match are displayed and are the files you should update as well.</p>
<p>Compared to previous versions, the versioncheck page has been re-designed for cpg1.5.x both in terms of visuals as well as functionality.</p>

<h3>First run</h3>
<p>When run for the first time, you will see the <a href"versioncheck_options_start">option</a> screen first. For a start, default options should be OK, so just submit the form. The script will then determine the coppermine version you're currently running, an try to look up the XML file on the coppermine repository that corresponds to your version. If successfull, it will compare all files that exist on your server against the most recent files that are recommended to use (trying to obtain that data from the repository). Subsequently, you should see a list of folders and files that are suppossed to exist on your server and an explanation if the file versions you have are the most recent. For details how to interpret the output, read on.</p>
<a name="versioncheck_description_end"></a>



<a name="versioncheck_options_start"></a><h3>Options<a href="#versioncheck_options_start" title="Link to this section"><img src="pics/anchor.gif" width="15" height="9" border="0" alt="" /></a></h3>
<p>There is a small number of options available on the versioncheck page that should be pretty self-explanatory:</p>
<ul>
    <li><strong>Display output</strong><br />
    Determines wether the full output with formatting is used, or only a reduced palin-text output
    <ul>
        <li><em>Full-screen</em><br />
        Use this by default. It will display as much detail as possible and has a nicer layout</li>
        <li><em>Text-only</em><br />
        If a supporter asks you to post your versioncheck-output, switch to this options, so you can easily copy the output and paste it into your posting on the coppermine support board. Only do so if a supporter explicitely asks for it! Another potential use for the text-only output is resources-consumption: if you suffer from time-outs, try using the plain-text option, as it consumes slightly less resources.</li>
    </ul>
    </li>
    <li><strong>Only show potential errors</strong><br />
    If you have no idea what all the output is suppossed to mean or if a supporter asks for it, you might want to tick this option to only display the folders/files that have issues.</li>
    <li><strong>Do not connect to the online repository</strong><br />
    If you check this option, the versioncheck script will not attempt to connect to the online repository and use the local XML file instead. Only use this option if connecting to the online repository doesn't work for you (e.g. if you're on an intranet and your server doesn't have internet access). The main drawback of not connecting to the online repository is the fact that you won't know about possible updates and most recent releases, so you better find the cause for your inability to connect to the online repository.</li>
</ul>
<p>The options screen lets you configure the versioncheck, or rather what is being displayed. The options aren't saved anywhere, so you will have to adjust them each time you run versioncheck. The default options should be OK for most users - only change them if you have good reasons to do so.</p>
<a name="versioncheck_options_end"></a>

 
<a name="versioncheck_comparison_start"></a><h3>Version comparison<a href="#versioncheck_comparison_start" title="Link to this section"><img src="pics/anchor.gif" width="15" height="9" border="0" alt="" /></a></h3>
<p>There is a lot of information packed into a small space. Here's an example of a possible output and what the output means:</p>
<ul>
    <li><strong>Path</strong><br />
    The folder- and file name</li>
    <li><strong>Missing</strong><br />
    If nothing is being displayed in this column, the folder/file exists on your server. If this is not the case (i.e. the folder/file does not exist on your server or is inaccessible), the column &quot;Missng&quot; will be populated with the result of this first, basic check.<br />
    Note: there are some folders/files that are mandatory to have; others are optional. Anyway, if you perform a fresh install or upgrade, you should make sure to upload all folders/files. You can then later delete some of the optional files if you want, although this doesn't save much webspace.<br />
    If a file is missing, all other steps that are next in the loop will not be performed - a missing file can't have a version number or similar. If versioncheck complains about missing files, use your FTP app to review if they are actually missing or inaccessible. If they are missing, re-upload them. If they are inaccessible, you will have to <a href="install_permissions.htm#permissions">assign the needed permissions</a>.</li>
    <li><strong>Permissions</strong><br />
    Displays the permissions assigned to the folder/file. For some folders, write permissions are needed, while for others read permissions are enough. If the permission level of a folder is good, the result will be displayed together with a remark (in brackets) like &quot;OK&quot; (may differ in your language). Using a script like versioncheck to actually check permissions on folders works OK, while it may or may not work very well on files. This being said, you should mostly be concerned about folders that don't have sufficient permissions. If files are being reported to have an improper set of permissions assigned, don't be to alarmed if the rest of your gallery is working just fine.<br />
    If permissions on folders need reviewing, read up the <a href="install_permissions.htm#permissions">permissions section of the docs</a> and do as suggested there.</li>
    <li><strong>Version</strong><br />
    The version of the file on your server. If it is identical to the version indicated in the repository, you should see an &quot;OK&quot;. If you're running an oudated version on your server you should get a fresh package and perform an upgrade.<br />
    Note: folders don't have version numbers, nor do binary files (like graphics) have one, that's why the column &quot;Version&quot; displays <tt class="code" title="not applicable">n/a</tt> for folders and binary files. Only files that contain textual content can have a version number, so don't be alarmed by the many &quot;n/a (OK)&quot;-messages.</li>
    <li><strong>Revision</strong><br />
    The revision of the file on your server. If it is identical to the revision indicated in the XML repository, you should see an &quot;OK&quot;. If you're running an oudated revision on your server you should get a fresh package and perform an upgrade.<br />
    Revisions are related to the versions - usually, if your version is OK, your revision should be OK as well. Only if you perform checkouts from the <a href="dev_subversion.htm#subversion">subversion repository</a>, the revisions may &quot;act up&quot;.<br />
    The same thing that applies to version numbers applies to revisions as well: only textual files can have revision numbers - folders and binary files don't have a revision number.<br />
    Confused? You don't have to: usually, you can savely ignore revisions - if you want to find out about what revisions are being used for, read the <a href="dev_subversion.htm#dev_subversion_revision">details on the subversion</a> page.</li>
    <li><strong>Modified</strong><br />
    If a file is accessible and the version and revision numbers match, the versioncheck script attempts to perform a check wether the file has been modified, compared to the original that comes with the coppermine package. This check is being performed by taking into account the MD5-hashes of the original file and your copy.<br />When performing a fresh install or upgrade, there should be no modified files. If they are being displayed as modified, there are several possible reasons:
    <ul>
        <li>You <strong>deliberately</strong> modified the file (e.g. by applying a custom modification to it). In this case, it's OK to ignore the warning in the &quot;Modified&quot;-column and continue</li>
        <li>Your file has not been transfered fully to the webserver. If this is the case, try to re-upload the file from your client to the server. If this doesn't help, your package might have gotten corrupt. Re-download a fresh one from the coppermine download section, un-archive it and re-upload the file. Make sure that your FTP app is configured to actually overwrite existing files</li>
        <li>You have used an improper FTP-mode to transfer the file to your webserver. Using FTP apps, you can transfer files in binary or ASCII-mode. Most up-to-date FTP clients have a feature that will automaically select the proper FTP-mode for each file. If this is not the case, try the manual appoach and explicitely specify the FTP-mode for your file uploads.</li>
        <li>Your webhost is injecting code into each file. Many free webspace providers (so-called &quot;freehosts&quot;) do this to inject advertisments into your files. There's little you can do then except signing up with paid webhosting or ignoring the &quot;Modified&quot;-warning and hoping gthat things will work anyway.
    </ul>
    </li>
    <li><strong>Comment</strong><br />
    The comment-column contains a short recommendation about what is suppossedly wrong and what you should do to fix this. No comments usually means that everything is OK.</li>
    <li><strong>Repository link</strong><br />
    The link to the SVN repository (web SVN) is meant as an additional feature for power-users and developers. Read the <a href="dev_subversion.htm#subversion">subversion repository</a> instructions to find out more. If everything is fine, you don't have to worry about the link anyway.</li>
    <li><strong>Help</strong><br />Feature not done yet - there currently is no help available. Will be added later (hopefully).</li>
</ul>
<a name="versioncheck_comparison_end"></a>

<a name="versioncheck_problems"></a><h3>Things that could go wrong<a href="#versioncheck_problems" title="Link to this section"><img src="pics/anchor.gif" width="15" height="9" border="0" alt="" /></a></h3>
<p>As the actions performed by the versioncheck script are complex, there are several things that can go wrong, depending on your webserver setup:</p>
<ul>
    <li><strong>No connection to the online XML repository</strong><br />
    If your server resides behind a proxy or a web filter that requires authentification or doesn't have internet connection at all (e.g. on a company's intranet), the versioncheck script may not be able to connect to the online XML repository. Use the corresponding option to keep the script from trying. The caveats mentioned in the options section applies.</li>
    <li>I get a white page, or a page without actual content<br />
    The script probably times out, as it consumes huge resources. You'll have to live without versioncheck then on your server setup, unless the server is yours to configure, so you can assign more memory and execution time to the script.</li>
</ul>
<a name="versioncheck_problems_end"></a>
<a name="versioncheck_end"></a>



<a name="downgrading"></a><h2>Downgrading from cpg1.5.x to an older version<a href="#downgrading" title="Link to this section"><img src="pics/anchor.gif" width="15" height="9" border="0" alt="" /></a></h2>
<p>CPG1.5.x incorporates many new features (compared to older versions), so we encourage all users to upgrade. However, there may be some who want to test cpg1.5.x and decide later that they want to go back to an older version. You have to keep in mind that a full upgrade changes the overall layout of coppermine's database that includes converting the encoding to unicode. This process can't be reverted: once you have done the conversion, the only way back is to restore a complete mySQL database dump (of course you have to create this backup <strong>before</strong> you upgraded in the first place). Creating mySQL dumps (backups) is recommended anyway, so you should do so <strong>now</strong>.</p>
<p>To make this absolutely clear: you can only downgrade if you used to have cpg1.4.x before and upgraded this version to cpg1.5.x. If you have made a <em>fresh</em> install of cpg1.5.x, you can't downgrade at all!</p>
<p>To actually perform the downgrade, replace all cpg1.5.x files on your server with the files from the older version (as if you were doing an upgrade, see above).<br />
<!--You then have to undo some changes in the database structure. To do so, run a query like<br />
<pre>ALTER TABLE `CPG_users` CHANGE `user_location`  `user_profile1` VARCHAR(255);
ALTER TABLE `CPG_users` CHANGE `user_interests` `user_profile2` VARCHAR(255);
ALTER TABLE `CPG_users` CHANGE `user_website` `user_profile3` VARCHAR(255);
ALTER TABLE `CPG_users` CHANGE `user_occupation` `user_profile4` VARCHAR(255);</pre><br />
using a tool like <a href="http://www.phpmyadmin.net/" rel="external" class="external">phpMyAdmin</a>, replacing <tt class="code">CPG_</tt> in the query with the prefix you have chosen during coppermine install.
-->
</p>
<a name="downgrading_end"></a>

<script type="text/javascript">
  cpgDocFooter();
  dateRevision(' $LastChangedDate$ ', ' $Revision$ ');
</script>

</body>
</html>